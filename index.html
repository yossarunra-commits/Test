<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Classroom System v3.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fdcb6e;
            --danger: #ff7675;
            --success: #55efc4;
            --bg: #f0f3f7;
            --glass: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #2d3436;
        }

        .teacher-mode-trigger {
            position: fixed;
            top: 10px;     
            right: 0px;   
            background: #000000;   
            color: #ffffff;        
            padding: 6px 12px;     
            border-radius: 4px;    
            font-size: 12px;       
            font-weight: 600;
            text-transform: uppercase; 
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: none;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            display: block; 
        }

        .teacher-mode-trigger:hover { 
            background: #2d3436;   
            transform: translateY(-2px); 
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .container {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 420px;
            position: relative;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { 
            color: var(--primary); 
            margin-bottom: 1rem; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        h3 {
            color: var(--secondary);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #eee;
            border-radius: 10px;
            font-family: 'Kanit';
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            outline: none;
        }

        button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button:hover { filter: brightness(1.1); transform: translateY(-2px); }
        button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-back { background: #dfe6e9; color: #636e72; width: auto; padding: 5px 15px; margin-bottom: 15px; font-size: 0.8rem; }
        .btn-logout { background: var(--danger); color: white; margin-top: 15px; font-size: 0.9rem; }
        .btn-delete-q { background: var(--danger); margin-top: 5px; }

        .screen { display: none; }
        .active { display: block; }

        .user-bar {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .subject-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border-left: 6px solid var(--primary);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .answer-item {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-size: 0.9rem;
            transition: box-shadow 0.3s;
        }

        .answer-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .timer { font-size: 1.1rem; color: var(--danger); font-weight: bold; margin: 8px 0; text-shadow: 1px 1px 2px rgba(255,255,255,0.5); }
        .hidden { display: none; }

        .scores-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin: 15px 0;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .score-item {
            font-size: 1.1rem;
            margin: 8px 0;
            color: #34495e;
        }

        .score-total {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .no-score {
            color: #636e72;
            font-style: italic;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px dashed #ddd;
        }

        /* ‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏π */
        .teacher-screen {
            background: linear-gradient(135deg, #ffffff, #f1f3f5);
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .teacher-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(108,92,231,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .teacher-screen h2, .teacher-screen h3 {
            text-align: center;
            color: var(--primary);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .teacher-screen button {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .teacher-screen button:hover {
            transform: translateY(-3px);
        }

        .teacher-screen select, .teacher-screen input, .teacher-screen textarea {
            border-color: var(--secondary);
            background: #f9fbfc;
        }

        .teacher-screen .user-bar {
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* ‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô */
        .student-screen {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .student-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(162,155,254,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .student-screen h2, .student-screen h3 {
            text-align: center;
            color: var(--secondary);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .student-screen button {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .student-screen button:hover {
            transform: translateY(-3px);
        }

        .student-screen select, .student-screen input, .student-screen textarea {
            border-color: var(--primary);
            background: #f9fbfc;
        }

        .student-screen .user-bar {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .student-screen .subject-card {
            transition: transform 0.2s;
        }

        .student-screen .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .task-item, .question-item {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-size: 0.9rem;
            transition: box-shadow 0.3s;
        }

        .task-item:hover, .question-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .add-btn {
            background: var(--accent);
            color: #2d3436;
            width: auto;
            padding: 8px 16px;
            margin-top: 10px;
        }

        .options-container {
            margin-top: 10px;
        }

        .option-input {
            width: 100%;
            margin: 5px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: var(--primary);
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <button class="teacher-mode-trigger" id="master-teacher-btn" onclick="showScreen('teacher-login')">TEACHER MODE</button>

    <div class="container">
        
        <div id="student-login" class="screen active">
            <h2 style="margin-top:0;">Student Login</h2>
            <p style="font-size: 0.9rem; color: #636e72;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            <input type="text" id="student-id-input" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 0000)" maxlength="5">
            <button onclick="loginStudent()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div id="teacher-login" class="screen">
            <button class="btn-back" onclick="showScreen('student-login')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <h2>Teacher Access</h2>
            <input type="password" id="teacher-pass" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π">
            <button onclick="loginTeacher()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
        </div>

        <div id="teacher-dash" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('student-login')">‚Üê ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏π</button>
                <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</h2>
                <button onclick="showScreen('teacher-donow')" style="background: #0984e3;">üìù ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Do Now</button>
                <button onclick="showScreen('teacher-scores')" style="background: #0984e3;">üìä ‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                <button onclick="showScreen('teacher-pending')" style="background: #0984e3;">üìå ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</button>
                <button onclick="showScreen('teacher-exam')" style="background: #0984e3;">üìÑ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                <button onclick="showScreen('teacher-attendance')" style="background: #0984e3;">‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
                <button onclick="showScreen('teacher-login-logs')" style="background: #0984e3;">üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>

        <div id="teacher-donow" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Do Now</h3>
                <select id="donow-subject-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    <option value="coding">Coding</option>
                    <option value="math">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                </select>
                <textarea id="donow-question" rows="3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                <button onclick="sendDoNow()" style="background: var(--success); color:#2d3436;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button style="background: var(--secondary);" onclick="showAnswers()">‡∏î‡∏π‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button class="btn-delete-q" onclick="deleteCurrentQuestion()">‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
            </div>
        </div>

        <div id="teacher-view-answers" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-donow')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h3>
                <select id="answers-subject-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    <option value="coding">Coding</option>
                    <option value="math">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                </select>
                <div id="answers-list"></div>
            </div>
        </div>

        <div id="teacher-scores" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                <select id="scores-subject-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    <option value="coding">Coding</option>
                    <option value="math">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                </select>
                <select id="student-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                </select>
                <input type="number" id="exam-score" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö (0-10)" min="0" max="10" step="0.5">
                <input type="number" id="collect-score" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö (0-40)" min="0" max="40" step="0.5">
                <button onclick="saveScores()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                <button style="background: var(--danger);" onclick="resetScores()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
            </div>
        </div>

        <div id="teacher-pending" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</h3>
                <select id="pending-subject-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    <option value="coding">Coding</option>
                    <option value="math">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                </select>
                <select id="pending-student-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                </select>
                <div id="pending-tasks-list"></div>
                <input type="text" id="new-pending-task" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà">
                <input type="file" id="pending-task-image" accept="image/*">
                <button class="add-btn" onclick="addPendingTask()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
                <button onclick="loadPendingTasks()">‡πÇ‡∏´‡∏•‡∏î‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</button>
                <button onclick="viewStudentPendingSubmissions()">‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            </div>
        </div>

        <div id="teacher-exam" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3>
                <select id="exam-subject-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    <option value="coding">Coding</option>
                    <option value="math">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                </select>
                <div id="exam-questions-list"></div>
                <button class="add-btn" onclick="addExamQuestionField()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                <button onclick="sendExam()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                <button onclick="startExam()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏≠‡∏ö</button>
                <button onclick="closeExam()">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö</button>
                <button onclick="deleteExam()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                <button onclick="viewExamAnswers()">‡∏î‡∏π‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <div id="exam-answers-list"></div>
            </div>
        </div>

        <div id="teacher-attendance" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h3>
                <select id="attendance-subject-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    <option value="coding">Coding</option>
                    <option value="math">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                </select>
                <input type="date" id="attendance-date">
                <table id="attendance-table">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="attendance-list"></tbody>
                </table>
                <button onclick="saveAttendance()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
            </div>
        </div>

        <div id="teacher-login-logs" class="screen">
            <div class="teacher-screen">
                <button class="btn-back" onclick="showScreen('teacher-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div id="login-logs-list"></div>
            </div>
        </div>

        <div id="student-dash" class="screen">
            <div class="student-screen">
                <div class="user-bar" id="student-name-tag"></div>
                
                <div id="coding-subject-card" class="subject-card" onclick="showScreen('coding-options')">
                    <h3 style="margin:0;">üíª ‡∏ß‡∏¥‡∏ä‡∏≤: Coding</h3>
                    <p style="margin:5px 0 0 0; font-size:0.8rem; opacity:0.8;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                </div>

                <div id="math-subject-card" class="subject-card" onclick="showScreen('math-options')">
                    <h3 style="margin:0;">üßÆ ‡∏ß‡∏¥‡∏ä‡∏≤: ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h3>
                    <p style="margin:5px 0 0 0; font-size:0.8rem; opacity:0.8;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                </div>

                <button class="btn-logout" onclick="logoutStudent()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
                
        <div id="coding-options" class="screen">
            <div class="student-screen">
                <button class="btn-back" onclick="showScreen('student-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h2>‡πÄ‡∏°‡∏ô‡∏π Coding</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button onclick="setSubject('coding'); showScreen('student-donow-form')">üìù 1. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Do Now</button>
                    <button onclick="setSubject('coding'); showScreen('student-scores')">üìä 2. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                    <button onclick="setSubject('coding'); showScreen('student-pending')">üìå 3. ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</button>
                    <button onclick="setSubject('coding'); showScreen('student-exam')">üìÑ 4. ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                </div>
            </div>
        </div>

        <div id="math-options" class="screen">
            <div class="student-screen">
                <button class="btn-back" onclick="showScreen('student-dash')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h2>‡πÄ‡∏°‡∏ô‡∏π ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button onclick="setSubject('math'); showScreen('student-donow-form')">üìù 1. ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Do Now</button>
                    <button onclick="setSubject('math'); showScreen('student-scores')">üìä 2. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                    <button onclick="setSubject('math'); showScreen('student-pending')">üìå 3. ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</button>
                    <button onclick="setSubject('math'); showScreen('student-exam')">üìÑ 4. ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                </div>
            </div>
        </div>

        <div id="student-donow-form" class="screen">
            <div class="student-screen">
                <button class="btn-back" onclick="showScreen(currentSubject === 'coding' ? 'coding-options' : 'math-options')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <div id="donow-active-area">
                    <div id="question-display" style="background: white; padding:15px; border-radius:10px; border: 1px solid #ddd; margin-bottom:10px; font-weight:600;"></div>
                    <div id="timer-display" class="timer"></div>
                    <textarea id="stu-answer" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                    <button id="btn-submit-answer" onclick="submitAnswer()">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                </div>
                <div id="donow-empty" class="hidden">
                    <p style="text-align: center; color: #636e72;">‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π üòä</p>
                </div>
            </div>
        </div>

        <div id="student-scores" class="screen">
            <div class="student-screen">
                <button class="btn-back" onclick="showScreen(currentSubject === 'coding' ? 'coding-options' : 'math-options')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h2 id="student-scores-h2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                <div id="scores-display" class="scores-card"></div>
            </div>
        </div>

        <div id="student-pending" class="screen">
            <div class="student-screen">
                <button class="btn-back" onclick="showScreen(currentSubject === 'coding' ? 'coding-options' : 'math-options')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</h3>
                <div id="student-pending-list"></div>
                <textarea id="pending-text-answer" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                <input type="file" id="pending-file-upload" accept="image/*">
                <button onclick="submitPendingWork()">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>

        <div id="student-exam" class="screen">
            <div class="student-screen">
                <button class="btn-back" onclick="showScreen(currentSubject === 'coding' ? 'coding-options' : 'math-options')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <h3>‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3>
                <div id="exam-status"></div>
                <div id="exam-form" class="hidden"></div>
                <button id="submit-exam-btn" class="hidden" onclick="submitExamAnswers()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
                <p id="exam-takers-count"></p>
            </div>
        </div>

    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
  // 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  const firebaseConfig = {
    apiKey: "AIzaSyDjUfktWF1QEO247xfX0fbiDc9HTUxA1AQ",
    authDomain: "realtimedata-7b490.firebaseapp.com",
    databaseURL: "https://realtimedata-7b490-default-rtdb.firebaseio.com",
    projectId: "realtimedata-7b490",
    storageBucket: "realtimedata-7b490.firebasestorage.app",
    messagingSenderId: "811896550662",
    appId: "1:811896550662:web:6ec11f951904c81da1da87",
    measurementId: "G-X69Z82RFSW"
  };

  // 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏õ‡πá‡∏ô Firebase)
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
function sendDoNow() {
    const subject = document.getElementById('donow-subject-select').value;
    const q = document.getElementById('donow-question').value;
    if(!subject || !q) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');

    // ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô Path ‡πÅ‡∏ö‡∏ö /
    firebase.database().ref(`currentDoNow/${subject}`).set({
        question: q,
        startTime: Date.now()
    });
    alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
}
  
        let currentSubject = '';
        function setSubject(s) {
            currentSubject = s;
        }

        let refreshIntervals = {};

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const teacherBtn = document.getElementById('master-teacher-btn');
            if(id === 'student-login') {
                teacherBtn.style.display = 'block';
            } else {
                teacherBtn.style.display = 'none';
            }

            // Clear existing intervals
            Object.values(refreshIntervals).forEach(clearInterval);
            refreshIntervals = {};

            if(id === 'student-donow-form') {
                loadStudentDoNow();
                refreshIntervals.donow = setInterval(loadStudentDoNow, 5000);
            }
            if(id === 'student-scores') {
                document.getElementById('student-scores-h2').innerText = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${currentSubject === 'coding' ? 'Coding' : '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'}`;
                loadStudentScores();
                refreshIntervals.scores = setInterval(loadStudentScores, 5000);
            }
            if(id === 'teacher-pending') {
                loadPendingTasks();
                refreshIntervals.pending = setInterval(loadPendingTasks, 5000);
            }
            if(id === 'student-pending') {
                loadStudentPending();
                refreshIntervals.studentPending = setInterval(loadStudentPending, 5000);
            }
            if(id === 'student-exam') {
                loadStudentExam();
                refreshIntervals.exam = setInterval(loadStudentExam, 5000);
            }
            if(id === 'teacher-exam') {
                loadTeacherExam();
                refreshIntervals.teacherExam = setInterval(loadTeacherExam, 5000);
            }
            if(id === 'teacher-attendance') {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('attendance-date').value = today;
                loadAttendance();
                refreshIntervals.attendance = setInterval(loadAttendance, 5000);
            }
            if(id === 'teacher-login-logs') {
                loadLoginLogs();
                refreshIntervals.loginLogs = setInterval(loadLoginLogs, 5000);
            }
            if(id === 'teacher-view-answers') {
                showAnswers();
                refreshIntervals.answers = setInterval(showAnswers, 5000);
            }
        }

        function loginTeacher() {
            if(document.getElementById('teacher-pass').value === '4938') {
                showScreen('teacher-dash');
                document.getElementById('teacher-pass').value = '';
            } else { 
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!'); 
            }
        }

        function sendDoNow() {
        const subject = document.getElementById('donow-subject-select').value;
        const q = document.getElementById('donow-question').value;
        
        if(!subject || !q) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase ‡πÅ‡∏ó‡∏ô LocalStorage
        firebase.database().ref(`currentDoNow/${subject}`).set({
            question: q,
            startTime: Date.now()
        });
        
        alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
function deleteCurrentQuestion() {
    const subject = document.getElementById('donow-subject-select').value;
    if(!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
    
    if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô?')) {
        // ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ Path ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏™‡πà‡∏á ‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ /
        firebase.database().ref(`currentDoNow/${subject}`).remove()
        .then(() => {
            document.getElementById('donow-question').value = '';
            alert('‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        });
    }
}

        function showAnswers() {
            let subject;
            if (document.getElementById('teacher-view-answers').classList.contains('active')) {
                subject = document.getElementById('answers-subject-select').value;
            } else {
                subject = document.getElementById('donow-subject-select').value;
            }
            if(!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
            const answers = JSON.parse(localStorage.getItem(`studentAnswers_${subject}`) || '[]');
            const container = document.getElementById('answers-list');
            container.innerHTML = answers.length ? '' : '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</p>';
            answers.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'answer-item';
                div.innerHTML = `<div><b>ID ${item.id}:</b> ${item.ans}</div>
                                 <button style="width:auto; padding:4px 8px; background:var(--danger); font-size:10px;" onclick="deleteAnswer(${index}, '${subject}')">‡∏•‡∏ö</button>`;
                container.appendChild(div);
            });
            document.getElementById('answers-subject-select').value = subject;
            showScreen('teacher-view-answers');
        }

        function deleteAnswer(idx, subject) {
            let ans = JSON.parse(localStorage.getItem(`studentAnswers_${subject}`) || '[]');
            ans.splice(idx, 1);
            localStorage.setItem(`studentAnswers_${subject}`, JSON.stringify(ans));
            showAnswers();
        }

        const students = [
            {id: '0000', name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Guest)', number: 0},
            {id: '4829', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏û‡∏ä‡∏£‡∏û‡∏• ‡∏ö‡∏∏‡∏ï‡∏£‡∏ò‡∏á‡∏ä‡∏±‡∏¢', number: 1},
            {id: '4865', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏®‡∏£‡∏±‡∏ì‡∏ç‡∏≤ ‡πÄ‡∏Å‡∏ï‡∏∏‡∏õ‡∏±‡∏ç‡∏ç‡∏≤', number: 2},
            {id: '4900', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ì‡∏±‡∏é‡∏ê‡∏ì‡∏¥‡∏ä‡∏≤ ‡∏™‡∏ô‡∏±‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á', number: 3},
            {id: '4903', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ê‡∏¥‡∏ï‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏ò‡∏¥‡∏ï‡∏¥‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏ó‡∏ß‡∏µ', number: 4},
            {id: '4938', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏£‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏ö‡∏±‡∏ß‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', number: 5},
            {id: '5003', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏õ‡∏ß‡∏£‡∏¥‡∏®‡∏≤ ‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°‡∏Ñ‡∏á‡∏™‡∏µ', number: 6},
            {id: '5007', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏õ‡∏±‡∏ô‡∏î‡∏≤ ‡πÅ‡∏ù‡∏á‡∏®‡∏£‡∏µ‡∏Ñ‡∏≥', number: 7},
            {id: '5014', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ì‡∏±‡∏ê‡∏ô‡∏î‡∏≤ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏™', number: 8},
            {id: '5018', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏†‡∏≤‡∏Å‡∏£ ‡∏ò‡∏≥‡∏£‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏Å‡∏∏‡∏•', number: 9},
            {id: '5030', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏†‡∏π‡∏£‡∏¥ ‡πÄ‡∏Å‡∏ï‡∏∏‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå', number: 10},
            {id: '5031', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏†‡∏≤‡∏£‡∏î‡∏≤ ‡πÄ‡∏û‡πá‡∏á‡∏Ñ‡∏∏‡πà‡∏¢', number: 11},
            {id: '5033', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ç‡∏≤‡∏ì‡∏¥‡∏î‡∏≤ ‡∏ï‡∏¥‡∏£‡∏£‡∏±‡∏ï‡∏ô‡πå‡πÄ‡∏°‡∏ò‡∏≤‡∏Å‡∏∏‡∏•', number: 12},
            {id: '5035', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏ß‡∏±‡∏ô‡∏ó‡∏ô‡∏µ‡∏¢‡πÄ‡∏Å‡∏ï‡∏∏‡∏®‡∏¥‡∏£‡∏¥', number: 13},
            {id: '5039', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏û‡∏ä‡∏†‡∏£ ‡∏ö‡∏∏‡∏ç‡∏ô‡∏≤‡∏Ñ‡∏Ñ‡πâ‡∏≤', number: 14},
            {id: '5040', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏™‡∏∏‡∏ó‡∏±‡∏®‡∏™‡∏¥‡∏ì‡∏µ ‡∏≠‡∏≤‡∏£‡∏¢‡∏ò‡∏≤‡∏î‡∏≤‡∏û‡∏á‡∏®‡πå', number: 15},
            {id: '5043', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ì‡∏ê‡∏°‡∏ô ‡∏£‡πà‡∏°‡πÇ‡∏û‡∏ò‡∏¥‡πå', number: 16},
            {id: '5045', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏®‡∏±‡∏Å‡∏¢‡πå‡∏ß‡∏£‡∏¥‡∏©‡∏ê‡πå ‡∏Å‡∏ß‡∏µ‡∏ß‡∏±‡∏à‡∏ô‡πå', number: 17},
            {id: '5056', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏• ‡∏™‡∏µ‡∏î‡∏≤‡πÇ‡∏™‡∏°', number: 18},
            {id: '5062', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÄ‡∏≠‡∏°‡∏¥‡∏Å‡∏≤ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏ô', number: 19},
            {id: '5063', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏°‡∏¥‡∏ô‡∏î‡∏≤ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏ô', number: 20},
            {id: '5065', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏à‡∏¥‡∏¨‡∏™‡∏≤ ‡∏ß‡∏á‡∏®‡πå‡πÄ‡∏™‡∏ß‡∏ï', number: 21},
            {id: '5075', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏õ‡∏£‡∏¥‡∏¢‡∏≤‡∏Å‡∏£ ‡∏£‡∏≠‡∏î‡∏Ñ‡∏∏‡πâ‡∏°', number: 22},
            {id: '5106', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏±‡∏ç‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡πÄ‡∏Å‡∏®‡∏à‡∏∏‡∏ë‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå', number: 23},
            {id: '5107', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ó‡∏£‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏ö‡∏∏‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê', number: 24},
            {id: '5144', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏≠‡∏≤‡∏ô‡∏¥‡∏Å ‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ß‡∏á‡∏®‡πå', number: 25},
            {id: '5248', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏†‡∏π‡∏£‡∏¥‡∏ì‡∏±‡∏ê ‡∏õ‡∏£‡∏∞‡∏ì‡∏µ‡∏´‡∏±‡∏®', number: 26},
            {id: '5249', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏†‡∏£‡∏ì‡πå‡∏ô‡∏†‡∏±‡∏™ ‡∏ó‡∏≠‡∏á‡∏¢‡∏±‡∏á', number: 27},
            {id: '5250', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏≤‡∏ô‡∏ï‡πå‡∏û‡∏¥‡∏ä‡∏ä‡∏≤ ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏™‡∏¥‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡πå', number: 28},
            {id: '5442', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏û‡∏á‡∏®‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏ò‡∏ô‡∏±‡∏ó‡∏ò‡∏ô‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå', number: 29},
            {id: '5443', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ì‡∏ê‡∏û‡∏á‡∏®‡πå ‡∏ä‡∏≤‡∏•‡∏µ‡∏£‡∏±‡∏Å‡∏©‡πå‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏•', number: 30},
            {id: '5450', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏õ‡∏ì‡∏¥‡∏è‡∏ê‡∏≤ ‡∏õ‡∏£‡∏∞‡∏ó‡∏¥‡∏ô‡πÅ‡∏™‡∏á‡∏ó‡∏≠‡∏á', number: 31},
            {id: '5462', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏õ‡∏†‡∏≤‡∏ß‡∏¥‡∏ô ‡∏ä‡πà‡∏ß‡∏á‡∏ä‡∏±‡∏¢', number: 32},
            {id: '5545', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ö‡∏∏‡∏ì‡∏¢‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏¢‡∏±‡∏á‡∏≠‡∏∏‡πà‡∏ô', number: 33},
            {id: '5581', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏™‡∏¥‡∏£‡∏¥ ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏°‡πÅ‡∏™‡∏á', number: 34},
            {id: '5582', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ó‡∏≠‡∏ù‡∏±‡∏ô ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πÇ‡∏™‡∏ò‡∏£‡∏â‡∏±‡∏ô‡∏ó‡πå', number: 35},
            {id: '5585', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏à‡∏¥‡∏ô‡∏ï‡πå‡∏ò‡∏ô‡∏±‡∏ä ‡∏ï‡∏£‡∏≤‡∏ä‡∏π', number: 36},
            {id: '5586', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏•‡∏î‡∏≤ ‡∏ô‡∏¥‡∏ß‡∏≤‡∏™‡∏ß‡∏±‡∏í‡∏ô‡πå', number: 37},
            {id: '5588', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡πå ‡πÄ‡∏•‡∏≤‡∏´‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏à‡∏£‡∏£‡∏¢‡∏≤', number: 38},
            {id: '5589', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡πÄ‡∏ó‡∏û ‡πÇ‡∏Å‡∏®‡∏•‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏•', number: 39},
            {id: '5590', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ì‡∏¥‡∏ä‡∏†‡∏±‡∏Ñ ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏•‡∏±‡∏î', number: 40},
            {id: '5592', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏õ ‡∏Ñ‡∏≥‡πÅ‡∏Å‡πâ‡∏ß', number: 41},
            {id: '5593', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏≠‡∏±‡∏°‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏ã‡∏π‡∏ä‡πà‡∏ß‡∏¢', number: 42},
            {id: '5619', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏õ‡∏±‡§£‡∏ì‡∏ß‡∏£‡∏£‡∏ò ‡πÇ‡∏£‡∏à‡∏ô‡∏ß‡∏¥‡∏†‡∏≤‡∏ï', number: 43},
            {id: '5709', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏Å‡∏°‡∏ô‡∏û‡∏£‡∏£‡∏ò‡∏ô‡πå ‡∏ò‡∏ô‡∏¥‡∏™‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏Å‡∏≥‡∏ò‡∏£', number: 44},
            {id: '5927', name: '‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡∏ò‡∏†‡∏±‡∏ó‡∏£ ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏¢‡πá‡∏ô', number: 45}
        ];

        function populateStudentSelects() {
            const selects = [document.getElementById('student-select'), document.getElementById('pending-student-select')];
            selects.forEach(select => {
                select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
                students.forEach(student => {
                    if (student.id !== '0000') { // Exclude guest from teacher selects if desired, but include for consistency
                        const option = document.createElement('option');
                        option.value = student.id;
                        option.text = `${student.id} - ${student.name} (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.number})`;
                        select.appendChild(option);
                    }
                });
            });
        }

        let currentStudentId = "";
        let isGuest = false;

        function loginStudent() {
            const id = document.getElementById('student-id-input').value;
            const student = students.find(s => s.id === id);
            if (student) {
                currentStudentId = id;
                isGuest = id === '0000';
                document.getElementById('student-name-tag').innerText = `üë§ ${student.name} (ID${id} ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.number})`;
                const codingCard = document.getElementById('coding-subject-card');
                const mathCard = document.getElementById('math-subject-card');
                codingCard.style.display = isGuest ? 'none' : 'block';
                mathCard.style.display = isGuest ? 'none' : 'block';
                if (!isGuest) {
                    let loginLogs = JSON.parse(localStorage.getItem('loginLogs') || '[]');
                    loginLogs.push({id: currentStudentId, name: student.name, number: student.number, timestamp: new Date().toISOString()});
                    localStorage.setItem('loginLogs', JSON.stringify(loginLogs));
                }
                showScreen('student-dash');
            } else { 
                alert('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'); 
            }
        }

        function logoutStudent() {
            if(confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                currentStudentId = "";
                isGuest = false;
                document.getElementById('student-id-input').value = "";
                showScreen('student-login');
            }
        }

        let timerInterval;
let lastStartTime = null; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡∏™‡∏∏‡∏î

function loadStudentDoNow() {
    const subject = currentSubject;
    
    firebase.database().ref(`currentDoNow/${subject}`).on('value', (snapshot) => {
        const data = snapshot.val();
        const active = document.getElementById('donow-active-area');
        const empty = document.getElementById('donow-empty');

        if(data && data.question) {
            active.classList.remove('hidden');
            empty.classList.add('hidden');
            document.getElementById('question-display').innerText = "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: " + data.question;

            // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á‡πÜ ---
            if (data.startTime !== lastStartTime) {
                lastStartTime = data.startTime;
                startTimer(180); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
            }
            // -----------------------------------------------------

        } else {
            active.classList.add('hidden');
            empty.classList.remove('hidden');
            document.getElementById('question-display').innerText = "";
            clearInterval(timerInterval); // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏π‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
            lastStartTime = null; 
        }
    });
}

function startTimer(sec) {
    if (timerInterval) clearInterval(timerInterval);
    
    let t = sec;
    const disp = document.getElementById('timer-display');
    
    // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡πÇ‡∏î‡∏ô‡∏•‡πá‡∏≠‡∏Ñ‡πÑ‡∏ß‡πâ)
    const btn = document.getElementById('btn-submit-answer');
    if(btn) btn.disabled = false;

    timerInterval = setInterval(() => {
        let m = Math.floor(t / 60), s = t % 60;
        if(disp) {
            disp.innerText = `‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${m}:${s < 10 ? '0'+s : s} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        }

        if (--t < 0) { 
            clearInterval(timerInterval); 
            if(disp) disp.innerText = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö!"; 
            if(btn) btn.disabled = true;
        }
    }, 1000);
}

        function submitAnswer() {
            if (isGuest) return alert('‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ');
            const subject = currentSubject;
            const ans = document.getElementById('stu-answer').value;
            
            if(!ans) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á');

            let allAns = JSON.parse(localStorage.getItem(`studentAnswers_${subject}`) || '[]');
            
            if(allAns.find(a => a.id === currentStudentId)) {
                return alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß');
            }
            
            allAns.push({ id: currentStudentId, ans: ans });
            localStorage.setItem(`studentAnswers_${subject}`, JSON.stringify(allAns));
            
            alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            document.getElementById('stu-answer').value = ""; 
            showScreen(currentSubject === 'coding' ? 'coding-options' : 'math-options');
        }

        function saveScores() {
            const subject = document.getElementById('scores-subject-select').value;
            const id = document.getElementById('student-select').value;
            const exam = parseFloat(document.getElementById('exam-score').value);
            const collect = parseFloat(document.getElementById('collect-score').value);

            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
            if (!id || isNaN(exam) || isNaN(collect)) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            if (exam < 0 || exam > 10 || collect < 0 || collect > 40) return alert('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï');

            let scores = JSON.parse(localStorage.getItem(`studentScores_${subject}`) || '{}');
            scores[id] = { exam, collect };
            localStorage.setItem(`studentScores_${subject}`, JSON.stringify(scores));

            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            document.getElementById('student-select').value = '';
            document.getElementById('exam-score').value = '';
            document.getElementById('collect-score').value = '';
        }

        function resetScores() {
            const subject = document.getElementById('scores-subject-select').value;
            const id = document.getElementById('student-select').value;
            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
            if (!id) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');

            if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ?')) {
                let scores = JSON.parse(localStorage.getItem(`studentScores_${subject}`) || '{}');
                delete scores[id];
                localStorage.setItem(`studentScores_${subject}`, JSON.stringify(scores));
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                document.getElementById('student-select').value = '';
                document.getElementById('exam-score').value = '';
                document.getElementById('collect-score').value = '';
            }
        }

        function loadStudentScores() {
            if (isGuest) {
                const disp = document.getElementById('scores-display');
                disp.innerHTML = '<p class="no-score">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏î‡πâ üòä</p>';
                return;
            }
            const subject = currentSubject;
            const disp = document.getElementById('scores-display');
            const scores = JSON.parse(localStorage.getItem(`studentScores_${subject}`) || '{}');

            if (scores[currentStudentId]) {
                const s = scores[currentStudentId];
                disp.innerHTML = `
                    <div class="score-item">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö: ${s.exam}/10</div>
                    <div class="score-item">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏Å‡πá‡∏ö: ${s.collect}/40</div>
                    <div class="score-total">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${s.exam + s.collect}/50</div>
                `;
            } else {
                disp.innerHTML = '<p class="no-score">‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô üòä</p>';
            }
        }

        // Pending System Functions
        function addPendingTask() {
            const subject = document.getElementById('pending-subject-select').value;
            const studentId = document.getElementById('pending-student-select').value;
            const taskText = document.getElementById('new-pending-task').value;
            const file = document.getElementById('pending-task-image').files[0];
            if (!subject || !studentId || !taskText) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            let pending = JSON.parse(localStorage.getItem(`pendingTasks_${subject}`) || '{}');
            if (!pending[studentId]) pending[studentId] = [];
            const task = { text: taskText, image: null };
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    task.image = e.target.result;
                    pending[studentId].push(task);
                    localStorage.setItem(`pendingTasks_${subject}`, JSON.stringify(pending));
                    document.getElementById('new-pending-task').value = '';
                    document.getElementById('pending-task-image').value = '';
                    loadPendingTasks();
                    alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                };
                reader.readAsDataURL(file);
            } else {
                pending[studentId].push(task);
                localStorage.setItem(`pendingTasks_${subject}`, JSON.stringify(pending));
                document.getElementById('new-pending-task').value = '';
                loadPendingTasks();
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            }
        }

        function loadPendingTasks() {
            const subject = document.getElementById('pending-subject-select').value;
            const studentId = document.getElementById('pending-student-select').value;
            if (!subject || !studentId) return;
            const pending = JSON.parse(localStorage.getItem(`pendingTasks_${subject}`) || '{}');
            const list = document.getElementById('pending-tasks-list');
            list.innerHTML = '';
            if (pending[studentId]) {
                pending[studentId].forEach((task, idx) => {
                    const div = document.createElement('div');
                    div.className = 'task-item';
                    div.innerHTML = task.text;
                    if (task.image) {
                        const img = document.createElement('img');
                        img.src = task.image;
                        img.style.width = '100px';
                        div.appendChild(img);
                    }
                    div.innerHTML += ` <button onclick="deletePendingTask('${subject}', '${studentId}', ${idx})">‡∏•‡∏ö</button>`;
                    list.appendChild(div);
                });
            }
        }

        function deletePendingTask(subject, studentId, idx) {
            let pending = JSON.parse(localStorage.getItem(`pendingTasks_${subject}`) || '{}');
            pending[studentId].splice(idx, 1);
            if (pending[studentId].length === 0) delete pending[studentId];
            localStorage.setItem(`pendingTasks_${subject}`, JSON.stringify(pending));
            loadPendingTasks();
        }

        function loadStudentPending() {
            if (isGuest) return;
            const subject = currentSubject;
            const pending = JSON.parse(localStorage.getItem(`pendingTasks_${subject}`) || '{}');
            const list = document.getElementById('student-pending-list');
            list.innerHTML = '';
            if (pending[currentStudentId] && pending[currentStudentId].length > 0) {
                pending[currentStudentId].forEach(task => {
                    const div = document.createElement('div');
                    div.className = 'task-item';
                    div.innerText = task.text;
                    if (task.image) {
                        const img = document.createElement('img');
                        img.src = task.image;
                        img.style.width = '100px';
                        div.appendChild(img);
                    }
                    list.appendChild(div);
                });
            } else {
                list.innerHTML = '<p>‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß üòä</p>';
            }
        }

        function submitPendingWork() {
            if (isGuest) return alert('‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');

            const subject = currentSubject;
            const fileInput = document.getElementById('pending-file-upload');
            const textAnswer = document.getElementById('pending-text-answer').value;
            const file = fileInput.files[0];

            if (!textAnswer && !file) {
                return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á');
            }

            let submissions = JSON.parse(localStorage.getItem(`pendingSubmissions_${subject}`) || '{}');
            if (!submissions[currentStudentId]) submissions[currentStudentId] = [];

            const submissionData = {
                text: textAnswer || "",
                image: null
            };

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    submissionData.image = e.target.result;
                    submissions[currentStudentId].push(submissionData);
                    localStorage.setItem(`pendingSubmissions_${subject}`, JSON.stringify(submissions));
                    alert('‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    fileInput.value = '';
                    document.getElementById('pending-text-answer').value = '';
                    loadStudentPending();
                };
                reader.readAsDataURL(file);
            } else {
                submissions[currentStudentId].push(submissionData);
                localStorage.setItem(`pendingSubmissions_${subject}`, JSON.stringify(submissions));
                alert('‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                document.getElementById('pending-text-answer').value = '';
                loadStudentPending();
            }
        }

        function viewStudentPendingSubmissions() {
            const subject = document.getElementById('pending-subject-select').value;
            const studentId = document.getElementById('pending-student-select').value;
            if (!subject || !studentId) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô');

            const submissions = JSON.parse(localStorage.getItem(`pendingSubmissions_${subject}`) || '{}');
            const list = document.getElementById('pending-tasks-list');
            list.innerHTML += '<h4>‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô:</h4>';

            if (submissions[studentId]) {
                submissions[studentId].forEach((item) => {
                    if (item.text) {
                        const p = document.createElement('p');
                        p.innerText = "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: " + item.text;
                        list.appendChild(p);
                    }
                    if (item.image) {
                        const img = document.createElement('img');
                        img.src = item.image;
                        img.style.width = '100px';
                        img.style.display = 'block';
                        img.style.marginBottom = '10px';
                        list.appendChild(img);
                    }
                });
            } else {
                list.innerHTML += '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</p>';
            }
        }

        // Exam System Functions
        let questionCount = 0;

        function addExamQuestionField() {
            questionCount++;
            const list = document.getElementById('exam-questions-list');
            const div = document.createElement('div');
            div.className = 'question-item';
            div.innerHTML = `
                <select class="question-type">
                    <option value="subjective">‡∏≠‡∏±‡∏ï‡∏ô‡∏±‡∏¢</option>
                    <option value="objective">‡∏õ‡∏£‡∏ô‡∏±‡∏¢</option>
                </select>
                <textarea placeholder="‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ${questionCount}"></textarea>
                <input type="number" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" min="1">
                <input type="file" class="question-image" accept="image/*">
                <div class="options-container hidden">
                    <input type="text" class="option-input" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A">
                    <input type="text" class="option-input" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B">
                    <input type="text" class="option-input" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å C">
                    <input type="text" class="option-input" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å D">
                    <input type="text" placeholder="‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (A/B/C/D)">
                </div>
                <div class="subjective-container hidden">
                    <input type="text" placeholder="‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)">
                </div>
                <button style="background: var(--danger); width: auto;" onclick="this.parentNode.remove()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ</button>
            `;
            const typeSelect = div.querySelector('.question-type');
            const optionsContainer = div.querySelector('.options-container');
            const subjectiveContainer = div.querySelector('.subjective-container');
            typeSelect.addEventListener('change', () => {
                optionsContainer.classList.toggle('hidden', typeSelect.value !== 'objective');
                subjectiveContainer.classList.toggle('hidden', typeSelect.value !== 'subjective');
            });
            list.appendChild(div);
        }

        function sendExam() {
            const subject = document.getElementById('exam-subject-select').value;
            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤');
            const questions = [];
            document.querySelectorAll('#exam-questions-list .question-item').forEach(item => {
                const type = item.querySelector('.question-type').value;
                const text = item.querySelector('textarea').value;
                const points = parseInt(item.querySelector('input[type=number]').value);
                const file = item.querySelector('.question-image').files[0];
                let options = [];
                let correct = '';
                let image = null;
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        image = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
                if (type === 'objective') {
                    options = Array.from(item.querySelectorAll('.option-input')).map(opt => opt.value);
                    correct = item.querySelector('input[type=text]:last-child').value;
                } else if (type === 'subjective') {
                    correct = item.querySelector('.subjective-container input').value;
                }
                if (text && !isNaN(points)) questions.push({type, text, points, options, correct, image});
            });
            if (questions.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö');
            localStorage.setItem(`examQuestions_${subject}`, JSON.stringify(questions));
            localStorage.removeItem(`examStarted_${subject}`);
            localStorage.removeItem(`examAnswers_${subject}`);
            alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        function startExam() {
            const subject = document.getElementById('exam-subject-select').value;
            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤');
            if (!localStorage.getItem(`examQuestions_${subject}`)) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö');
            localStorage.setItem(`examStarted_${subject}`, 'true');
            alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
        }

        function closeExam() {
            const subject = document.getElementById('exam-subject-select').value;
            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤');
            localStorage.setItem(`examStarted_${subject}`, 'false');
            alert('‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        function deleteExam() {
            const subject = document.getElementById('exam-subject-select').value;
            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤');
            if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö?')) {
                localStorage.removeItem(`examQuestions_${subject}`);
                localStorage.removeItem(`examStarted_${subject}`);
                localStorage.removeItem(`examAnswers_${subject}`);
                document.getElementById('exam-questions-list').innerHTML = '';
                questionCount = 0;
                alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            }
        }

        function loadTeacherExam() {
            const subject = document.getElementById('exam-subject-select').value;
            if (!subject) return;
            const questions = JSON.parse(localStorage.getItem(`examQuestions_${subject}`) || '[]');
            const list = document.getElementById('exam-questions-list');
            list.innerHTML = '';
            questionCount = 0;
            questions.forEach(q => {
                addExamQuestionField();
                const item = list.lastChild;
                item.querySelector('.question-type').value = q.type;
                item.querySelector('textarea').value = q.text;
                item.querySelector('input[type=number]').value = q.points;
                if (q.image) {
                    const img = document.createElement('img');
                    img.src = q.image;
                    img.style.width = '100px';
                    item.appendChild(img);
                }
                if (q.type === 'objective') {
                    const opts = item.querySelectorAll('.option-input');
                    q.options.forEach((opt, i) => opts[i].value = opt);
                    item.querySelector('.options-container input[type=text]:last-child').value = q.correct;
                    item.querySelector('.options-container').classList.remove('hidden');
                } else if (q.type === 'subjective') {
                    item.querySelector('.subjective-container input').value = q.correct;
                    item.querySelector('.subjective-container').classList.remove('hidden');
                }
            });
        }

        function viewExamAnswers() {
            const subject = document.getElementById('exam-subject-select').value;
            if (!subject) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤');
            const answers = JSON.parse(localStorage.getItem(`examAnswers_${subject}`) || '{}');
            const list = document.getElementById('exam-answers-list');
            list.innerHTML = '';
            Object.keys(answers).forEach(studentId => {
                const studentAns = answers[studentId];
                const div = document.createElement('div');
                div.innerHTML = `<h4>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ID: ${studentId}</h4>`;
                studentAns.forEach((ans, idx) => {
                    div.innerHTML += `<p>‡∏Ç‡πâ‡∏≠ ${idx+1}: ${ans}</p>`;
                });
                const button = document.createElement('button');
                button.innerText = '‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥';
                button.onclick = () => autoGradeExam(subject, studentId);
                div.appendChild(button);
                list.appendChild(div);
            });
            if (Object.keys(answers).length === 0) list.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</p>';
        }

        function autoGradeExam(subject, studentId) {
            const questions = JSON.parse(localStorage.getItem(`examQuestions_${subject}`));
            const answers = JSON.parse(localStorage.getItem(`examAnswers_${subject}`));
            const studentAns = answers[studentId];
            let score = 0;
            questions.forEach((q, idx) => {
                if (q.type === 'objective' && q.correct && studentAns[idx].toUpperCase() === q.correct.toUpperCase()) {
                    score += q.points;
                } else if (q.type === 'subjective' && q.correct && studentAns[idx].trim().toLowerCase() === q.correct.trim().toLowerCase()) {
                    score += q.points;
                }
            });
            let scores = JSON.parse(localStorage.getItem(`studentScores_${subject}`) || '{}');
            if (!scores[studentId]) scores[studentId] = {exam: 0, collect: 0};
            scores[studentId].exam = score;
            localStorage.setItem(`studentScores_${subject}`, JSON.stringify(scores));
            alert(`‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`);
        }

        function loadStudentExam() {
            if (isGuest) return;
            const subject = currentSubject;
            const started = localStorage.getItem(`examStarted_${subject}`) === 'true';
            const questions = JSON.parse(localStorage.getItem(`examQuestions_${subject}`));
            const allAnswers = JSON.parse(localStorage.getItem(`examAnswers_${subject}`) || '{}');
            const status = document.getElementById('exam-status');
            const form = document.getElementById('exam-form');
            const submitBtn = document.getElementById('submit-exam-btn');
            const takers = Object.keys(allAnswers).length;
            document.getElementById('exam-takers-count').innerText = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≠‡∏ö: ${takers}`;
            if (!questions) {
                status.innerText = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö';
                form.classList.add('hidden');
                submitBtn.classList.add('hidden');
                return;
            }
            if (!started) {
                status.innerText = '‡∏£‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏≠‡∏ö';
                form.classList.add('hidden');
                submitBtn.classList.add('hidden');
                return;
            }
            if (allAnswers[currentStudentId]) {
                status.innerText = '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß';
                form.classList.add('hidden');
                submitBtn.classList.add('hidden');
                return;
            }
            status.innerText = '';
            form.classList.remove('hidden');
            submitBtn.classList.remove('hidden');
            form.innerHTML = '';
            questions.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'question-item';
                div.innerHTML = `<p>${q.text} (${q.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</p>`;
                if (q.image) {
                    const img = document.createElement('img');
                    img.src = q.image;
                    img.style.width = '100px';
                    div.appendChild(img);
                }
                if (q.type === 'objective') {
                    q.options.forEach((opt, optIdx) => {
                        const label = document.createElement('label');
                        label.innerHTML = `<input type="radio" name="exam-ans-${idx}" value="${String.fromCharCode(65 + optIdx)}"> ${String.fromCharCode(65 + optIdx)}. ${opt}`;
                        div.appendChild(label);
                    });
                } else {
                    const textarea = document.createElement('textarea');
                    textarea.id = `exam-ans-${idx}`;
                    div.appendChild(textarea);
                }
                form.appendChild(div);
            });
        }

        function submitExamAnswers() {  
            const subject = currentSubject;
            const questions = JSON.parse(localStorage.getItem(`examQuestions_${subject}`));
            const answers = [];
            questions.forEach((q, idx) => {
                if (q.type === 'objective') {
                    const selected = document.querySelector(`input[name="exam-ans-${idx}"]:checked`);
                    answers.push(selected ? selected.value : '');
                } else {
                    answers.push(document.getElementById(`exam-ans-${idx}`).value);
                }
            });
            let allAnswers = JSON.parse(localStorage.getItem(`examAnswers_${subject}`) || '{}');
            allAnswers[currentStudentId] = answers;
            localStorage.setItem(`examAnswers_${subject}`, JSON.stringify(allAnswers));
            alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏î‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π');
            showScreen(currentSubject === 'coding' ? 'coding-options' : 'math-options');
        }

        // Attendance System
        function loadAttendance() {
            const subject = document.getElementById('attendance-subject-select').value;
            const date = document.getElementById('attendance-date').value;
            if (!subject || !date) return;
            const list = document.getElementById('attendance-list');
            list.innerHTML = '';
            const attendanceKey = `attendance_${subject}_${date}`;
            let attendance = JSON.parse(localStorage.getItem(attendanceKey) || '{}');
            students.forEach(student => {
                if (student.id === '0000') return;
                const tr = document.createElement('tr');
                const select = document.createElement('select');
                select.dataset.id = student.id;
                ['‡∏°‡∏≤', '‡∏Ç‡∏≤‡∏î', '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', '‡∏•‡∏≤‡∏Å‡∏¥‡∏à'].forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt;
                    option.text = opt;
                    if (attendance[student.id] === opt) option.selected = true;
                    select.appendChild(option);
                });
                tr.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name} (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.number})</td>
                    <td></td>
                `;
                tr.querySelector('td:last-child').appendChild(select);
                list.appendChild(tr);
            });
        }

        function saveAttendance() {
            const subject = document.getElementById('attendance-subject-select').value;
            const date = document.getElementById('attendance-date').value;
            if (!subject || !date) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
            const attendanceKey = `attendance_${subject}_${date}`;
            let attendance = {};
            document.querySelectorAll('#attendance-list select').forEach(select => {
                attendance[select.dataset.id] = select.value;
            });
            localStorage.setItem(attendanceKey, JSON.stringify(attendance));
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            loadAttendance();  // Reload to view saved data
        }

        // Login Logs
        function loadLoginLogs() {
            const logs = JSON.parse(localStorage.getItem('loginLogs') || '[]');
            const list = document.getElementById('login-logs-list');
            list.innerHTML = '';
            if (logs.length > 0) {
                logs.forEach((log, index) => {
                    const date = new Date(log.timestamp);
                    const time = `${date.getHours().toString().padStart(2, '0')}.${date.getMinutes().toString().padStart(2, '0')}.${date.getSeconds().toString().padStart(2, '0')}‡∏ô.`;
                    const div = document.createElement('div');
                    div.className = 'answer-item';
                    div.innerHTML = `${log.id}-${log.name} ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${log.number} ‡πÄ‡∏ß‡∏•‡∏≤ ${time}
                                     <button style="width:auto; padding:4px 8px; background:var(--danger); font-size:10px;" onclick="deleteLoginLog(${index})">‡∏•‡∏ö</button>`;
                    list.appendChild(div);
                });
            } else {
                list.innerHTML = '<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>';
            }
        }

        function deleteLoginLog(index) {
            let logs = JSON.parse(localStorage.getItem('loginLogs') || '[]');
            logs.splice(index, 1);
            localStorage.setItem('loginLogs', JSON.stringify(logs));
            loadLoginLogs();
        }

        document.getElementById('exam-subject-select').addEventListener('change', loadTeacherExam);
        document.getElementById('attendance-subject-select').addEventListener('change', loadAttendance);
        document.getElementById('attendance-date').addEventListener('change', loadAttendance);
        document.getElementById('answers-subject-select').addEventListener('change', showAnswers);
        populateStudentSelects();
    </script>
</body>
</html> 


